<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="/style.css">

</head>

<body>
    <div class="chat">
        <div class="top">
            <svg xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink"
                width="30" height="30" x="0" y="0" viewBox="0 0 511 511"
                style="enable-background:new 0 0 512 512" xml:space="preserve">
                <g>
                    <path fill="#AFE6FF"
                        d="M255.5 6.418c-97.088 0-156.896 54.764-157.06 54.856 0 0-2.487 3.103-2.951 5.167-3.778 16.768-7.307 39.242-7.307 55.641 0 139.337 117.502 252.263 256.838 252.263 53.655 0 113.351-25.716 153.303-56.635.894-.692 3.729-5.339 3.729-5.339.176-1.075 5.739-23.227 5.739-53.662 0-139.337-112.954-252.291-252.291-252.291z"
                        opacity="1" data-original="#afe6ff"></path>
                    <path fill="#73C8F0"
                        d="M344.998 367.223c-139.337 0-252.291-112.955-252.291-252.291 0-18.417 1.986-36.362 5.733-53.658C40.418 107.498 3.209 178.759 3.209 258.709c0 60.696 21.434 116.386 57.145 159.915l390.292.004c24.806-30.223 42.77-66.395 51.406-106.257-43.096 34.327-97.675 54.852-157.054 54.852z"
                        opacity="1" data-original="#73c8f0"></path>
                    <path fill="#FF965A"
                        d="M358.924 207.423h-1l-6.835-33.606 6.835-27.725h1c13.361 0 24.193 10.832 24.193 24.193v12.946c0 13.36-10.831 24.192-24.193 24.192z"
                        opacity="1" data-original="#ff965a"></path>
                    <ellipse cx="257.647" cy="345.017" fill="#FF3C3C" rx="125.47" ry="101.485" opacity="1"
                        data-original="#ff3c3c"></ellipse>
                    <path fill="#FF3C3C"
                        d="m392.47 335.457-2.341-.518-80.315-3.805c-77.167-3.656-141.731 57.922-141.731 135.176v29.109C195.322 505.482 224.764 511 255.5 511c78.166 0 148.666-35.744 195.146-92.373v-10.711c0-34.807-24.191-64.938-58.176-72.459z"
                        opacity="1" data-original="#ff3c3c"></path>
                    <path fill="#DC1428"
                        d="M257.842 430.469c75.575 0 136.841-10.289 136.841-71.417 0-8.175-1.106-16.14-3.185-23.811l-136.292-30.159-136.719 30.345c-34.235 7.599-58.133 37.954-58.133 72.45v10.746C88.81 453.308 126.333 480.27 169.3 495.89c10.999-37.872 46.03-65.476 87.478-65.422l1.064.001z"
                        opacity="1" data-original="#dc1428"></path>
                    <path fill="#FF3C3C"
                        d="M383.117 345.017c0 56.048-56.175 65.482-125.47 65.482s-125.47-9.434-125.47-65.482 56.175-101.485 125.47-101.485 125.47 45.436 125.47 101.485z"
                        opacity="1" data-original="#ff3c3c"></path>
                    <path fill="#DC1428"
                        d="M343.908 331.29c0 38.533-38.62 69.771-86.261 69.771s-86.261-31.237-86.261-69.771 38.62-29.206 86.261-29.206 86.261-9.327 86.261 29.206z"
                        opacity="1" data-original="#dc1428"></path>
                    <path fill="#FF965A"
                        d="M255.741 381.231c20.073 0 36.344-16.272 36.344-36.344V263.48h-72.689v81.406c0 20.073 16.272 36.345 36.345 36.345z"
                        opacity="1" data-original="#ff965a"></path>
                    <path fill="#EF6A30"
                        d="m243.791 338.325.005-.002a102.78 102.78 0 0 1-24.399-4.297V263.48h66.658l6.031 54.423c-8.951 14.408-33.969 21.189-48.295 20.422z"
                        opacity="1" data-original="#ef6a30"></path>
                    <path fill="#FFBE82"
                        d="M354.335 135.963c0-33.168-21.278-63.497-54.445-63.497h-88.298c-9.464 0-18.132 2.477-25.694 6.777v175.309c0 38.264 30.776 69.577 69.038 69.867.268.002.537.003.805.003 56.987 0 103.183-46.197 103.183-103.183v-32.575z"
                        opacity="1" data-original="#ffbe82"></path>
                    <path fill="#EF6A30"
                        d="M358.924 188.385v-23.256a9.174 9.174 0 0 1 9.174 9.174v4.909a9.173 9.173 0 0 1-9.174 9.173z"
                        opacity="1" data-original="#ef6a30"></path>
                    <path fill="#FF965A"
                        d="M127.343 183.23c0 13.361 10.832 24.193 24.193 24.193h1.553l12.385-26.092-12.178-35.239h-1.761c-13.361 0-24.193 10.832-24.193 24.193v12.945z"
                        opacity="1" data-original="#ff965a"></path>
                    <path fill="#EF6A30"
                        d="M141.695 179.39c0 5.435 4.406 9.841 9.841 9.841v-24.949c-5.435 0-9.841 4.406-9.841 9.841z"
                        opacity="1" data-original="#ef6a30"></path>
                    <path fill="#FFFFFF"
                        d="M135.089 190.49c0 9.083 7.364 16.447 16.447 16.447v-32.694c-9.083 0-16.447 7.364-16.447 16.447z"
                        opacity="1" data-original="#ffffff"></path>
                    <path fill="#FF965A"
                        d="M211.159 182.68v7.276a8.594 8.594 0 0 0 17.188 0v-7.276zM281.182 182.68v7.276a8.594 8.594 0 0 0 17.188 0v-7.276z"
                        opacity="1" data-original="#ff965a"></path>
                    <path fill="#373C41"
                        d="M219.753 191.667a8.594 8.594 0 0 1-8.594-8.594v-11.055l3.168-4.797-3.168-4.797v-2.855a8.594 8.594 0 0 1 17.188 0v23.504a8.594 8.594 0 0 1-8.594 8.594zM289.776 191.667a8.594 8.594 0 0 1-8.594-8.594v-11.055l3.168-4.797-3.168-4.797v-2.855a8.594 8.594 0 0 1 17.188 0v23.504a8.594 8.594 0 0 1-8.594 8.594zM231.075 146.678h-25.062a8.594 8.594 0 0 1 0-17.188h25.062a8.594 8.594 0 0 1 0 17.188zM302.691 146.678h-25.062a8.594 8.594 0 0 1 0-17.188h25.062a8.594 8.594 0 0 1 0 17.188z"
                        opacity="1" data-original="#373c41"></path>
                    <path fill="#BE1423"
                        d="M287.385 239.211h-8.849l-23.305 4.838-23.305-4.838h-7.828c-2.626 0-4.724 2.292-4.374 4.895a36.116 36.116 0 0 0 4.823 13.766l47.189 13.984c10.657-5.231 18.378-15.528 20.023-27.75.35-2.603-1.748-4.895-4.374-4.895z"
                        opacity="1" data-original="#be1423"></path>
                    <path fill="#FF965A"
                        d="M342.16 100.066c.986.001 1.96-.047 2.928-.119-9.264-16.253-25.026-27.482-45.198-27.482h-88.298c-9.464 0-18.132 2.477-25.694 6.777v2.196c-19.413 9.058-32.087 28.451-32.087 52.25l-2.274 54.974v31.554c0 59.556 49.9 107.227 109.797 104.054-43.381-12.598-75.091-52.632-75.091-100.077.258-5.863 0-62.674 0-84.254l.002-.461c.165-21.948 18.249-39.549 40.197-39.527z"
                        opacity="1" data-original="#ff965a"></path>
                    <path fill="#FF965A"
                        d="M241.816 203.866c-2.136 8.531 1.746 17.824 9.171 20.625a13.42 13.42 0 0 0 9.508 0c7.425-2.801 11.308-12.094 9.171-20.625l-7.082-28.282c-1.783-7.12-11.902-7.12-13.685 0z"
                        opacity="1" data-original="#ff965a"></path>
                    <path fill="#262A2D"
                        d="M358.924 78.715V188.663c-7.633 0-13.821-6.188-13.821-13.821v-61.026c0-13.479-7.586-25.903-19.707-31.799a47.627 47.627 0 0 0-.89-.423v-2.878h34.418z"
                        opacity="1" data-original="#262a2d"></path>
                    <path fill="#FFFFFF"
                        d="M214.327 175.186a3.168 3.168 0 0 1-3.168-3.168v-9.594a3.168 3.168 0 1 1 6.336 0v9.594a3.168 3.168 0 0 1-3.168 3.168zM284.35 175.186a3.168 3.168 0 0 1-3.168-3.168v-9.594a3.168 3.168 0 1 1 6.336 0v9.594a3.168 3.168 0 0 1-3.168 3.168z"
                        opacity="1" data-original="#ffffff"></path>
                    <path fill="#FF3C3C"
                        d="M224.55 257.869c6.351 10.593 17.941 17.686 31.19 17.686 5.74 0 11.166-1.335 15.992-3.704-2.075-13.015-13.347-22.963-26.946-22.963-8.026-.001-15.242 3.465-20.236 8.981z"
                        opacity="1" data-original="#ff3c3c"></path>
                    <path fill="#FFFFFF"
                        d="M273.409 248.887h-36.357a5.127 5.127 0 0 1-5.127-5.127v-4.55h46.611v4.55a5.128 5.128 0 0 1-5.127 5.127z"
                        opacity="1" data-original="#ffffff"></path>
                    <path fill="#373C41"
                        d="M270.803.102c-29.531.027-53.271 24.27-52.746 53.797.224 12.581.564 25.16 1.082 37.734l.013.312 123.008.121c21.404.021 38.766-17.324 38.766-38.728V0z"
                        opacity="1" data-original="#373c41"></path>
                    <path fill="#262A2D"
                        d="M219.54 59.015c0-32.485 26.318-58.827 58.803-58.857L380.925.063V0L210.339.158c-32.485.03-58.803 26.373-58.803 58.857v129.649c7.633 0 13.821-6.188 13.821-13.821v-61.026l.001-.242c.082-12.047 10.103-21.672 22.151-21.66l32.032.031V59.015z"
                        opacity="1" data-original="#262a2d"></path>
                    <path fill="#DC1428"
                        d="M208.149 491.404a6 6 0 0 1-6-6v-69.342a6 6 0 0 1 12 0v69.342a6 6 0 0 1-6 6z" opacity="1"
                        data-original="#dc1428"></path>
                    <path fill="#FFFFFF"
                        d="M208.149 476.403a6 6 0 0 1-6-6v-69.342a6 6 0 0 1 12 0v69.342a6 6 0 0 1-6 6z" opacity="1"
                        data-original="#ffffff"></path>
                    <path fill="#DC1428"
                        d="M306.155 491.404a6 6 0 0 1-6-6v-69.342a6 6 0 0 1 12 0v69.342a6 6 0 0 1-6 6z" opacity="1"
                        data-original="#dc1428"></path>
                    <path fill="#FFFFFF"
                        d="M306.155 476.403a6 6 0 0 1-6-6v-69.342a6 6 0 0 1 12 0v69.342a6 6 0 0 1-6 6zM146.979 229.86a4.5 4.5 0 0 1-4.5-4.5v-33.694a4.5 4.5 0 0 1 9 0v33.694a4.5 4.5 0 0 1-4.5 4.5zM375.371 192.991c0 9.083-7.364 16.447-16.447 16.447v-32.694c9.083 0 16.447 7.364 16.447 16.447z"
                        opacity="1" data-original="#ffffff"></path>
                    <path fill="#FFFFFF"
                        d="M363.481 232.362a4.5 4.5 0 0 1-4.5-4.5v-33.694a4.5 4.5 0 0 1 9 0v33.694a4.5 4.5 0 0 1-4.5 4.5z"
                        opacity="1" data-original="#ffffff"></path>
                </g>
            </svg>
            <p>Rose Edlin</p>
            <small>Online</small>
        </div>
        <div class="messages">
            @include('receive', ['message' => 'Hello! How can I help you today?'])
        </div>
        <div class="bottom">
            <form action="">
                <input type="text" id="message" name="message" placeholder="Type your message here..."
                    autocomplete="off">
                <button type="submit"></button>
            </form>
        </div>
    </div>
</body>

<script src="https://js.pusher.com/8.0.1/pusher.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
    const pusher = new Pusher('{{ config('broadcasting.connections.pusher.key') }}', {
        cluster: '{{ config('broadcasting.connections.pusher.options.cluster') }}',
        encrypted: true
    });

    console.log('{{ config('broadcasting.connections.pusher.key') }}');
    console.log('{{ config('broadcasting.connections.pusher.options.cluster') }}');

    const channel = pusher.subscribe('public');

    // Bind event after connection is established
    pusher.connection.bind('connected', function() {
        //pusher connection state
        const socketId = pusher.connection.socket_id;
        console.log(socketId); // Check if socketId is defined here

        // Attach submit event to the form
        $("form").submit(function(e) {
            e.preventDefault();

            // Send AJAX request with the socket ID
            $.ajax({
                url: "/broadcast",
                method: "POST",
                headers: {
                    'X-Socket-Id': socketId
                },
                data: {
                    _token: '{{ csrf_token() }}',
                    message: $("form #message").val(),
                }
            }).done(function(res) {
                $(".messages > .message").last().after(res);
                $("form #message").val("");
                $(document).scrollTop($(document).height());
            }).fail(function(xhr, status, error) {
                console.log("AJAX Error:", error); // Log AJAX errors
            });
        });
    });

    // Receive message
    channel.bind('chat', function(data) {
        console.log("Received message:", data); // Log received message
        $.post("/receive", {
            _token: '{{ csrf_token() }}',
            message: data.message,
        }).done(function(res) {
            $(".messages > .message").last().after(res);
            $(document).scrollTop($(document).height());
        }).fail(function(xhr, status, error) {
            console.log("Error processing message:", error); // Log any errors during message processing
        });
    });
</script>

</html>
